<html>
    <head>
        <title>The Effects of COVID-19 on FIRST Robotics: An FRC Retrospective</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
        <script type="text/javascript" src="teams_by_state.json"></script>
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="container">
            <div class="chart-container" style="width: 400px; height: 400px; margin-bottom: 160px">
                <p style="font-size: 20px">FRC Events Scheduled for 2020 Season</p>
                <canvas id="eventSuspended" width="200" height="200"></canvas>
                <p class="disclaimer">All data gathered from <a target="_blank" href="https://www.thebluealliance.com/apidocs">The Blue Alliance API</a></p>
                <p class="disclaimer">View all event data by week <a target="_blank" href="event_display.json">here</a></p>
            </div>
            <p style="margin: 25px 21vw 0 21vw">
                The figure above shows a 67.88% suspension rate for FRC events in the 2020 Season. There were
                193 events scheduled for Infinite Recharge, sadly due to complications from COVID-19
                only 62 events were conducted during weeks 1 and 2 of competition. These numbers may not be shocking 
                considering how early into the season FIRST chose to suspend all events, but the data regarding 
                the teams affected is much more concerning. Since the suspension of all events on 
                <a href="https://www.firstinspires.org/covid-19">March 12</a>, many teams have been left in limbo 
                regarding whether or not their robot will ever touch the gray carpet. It is unfortunate that
                this is our situation, because the results of many teams' hard work was ultimately (and unknowingly) 
                hinged upon the decision to compete before or after week 2. In this
                article I hope to illustrate exactly how much damage has been dealt, and which teams have an
                advantage going into off-season events (or possibly postponed FIRST sponsored events).
            </p>
            <div class="chart-container" style="width: 400px; height: 400px; margin: 80px 0 200px 0">
                <p style="font-size: 20px">FRC Teams that have Attended an Event in 2020 Season</p>
                <canvas id="teamsPlayed" width="200" height="200"></canvas>
                <p class="disclaimer">All data gathered from <a target="_blank" href="https://www.thebluealliance.com/apidocs">The Blue Alliance API</a></p>
                <p class="disclaimer">View all team data by events <a target="_blank" href="teams_by_events.json">here</a></p>
            </div>
            <p style="margin: 25px 21vw 0 21vw">
                There are 3,912 teams registered for the 2020 Season. As the figure above shows, 1,847
                teams were scheduled to attend an event, but did not attend within the first two weeks
                of competition. This is a staggering 47% of teams that have yet to play a single match of Infinite Recharge.
                The difference between having one or two events worth of experience versus not playing at all
                is a stark one, so it is important to know what we're up against in the coming months. Those who have played will
                certainly have an advantage over those who have not; how much of an advantage is impossible to say.
                What we can do now is take a look at the data and assess our situation from afar to gain some
                insight on the regions most affected. Below is an input field that will generate a chart
                similar to the figure above displaying the statistics for the state / province entered.
                For example, entering 'Indiana' will display a figure of how many teams have or have not
                attended an event in the state of Indiana. The search is not limited to the United States,
                any state or province where there is an FRC will provide data (e.g. 'Istanbul', or 'Qu√©bec').
            </p>
            <p style="font-size: 20px; margin: 50px 21vw -30px 21vw; display: flex; justify-content: center;">
                Enter a state / province below to view participation statistics
            </p>
            <div class="search-container">
                <input type="text" id="search" placeholder="Enter a state / province" onfocus="showDropdown()" onkeyup="fillDropdown(document.getElementById('search').value)" autocomplete="off"></input>
                <div id="filter"></div>
            </div>
            <div id="display-cont" class="chart-container" style="width: 400px; height: 400px; margin: 80px 0 200px 0; display: none">
                <p id="chartTitle" style="font-size: 20px; margin-top: -10px"></p>
                <p id="displayDisclaimer" class="disclaimer">All data gathered from <a target="_blank" href="https://www.thebluealliance.com/apidocs">The Blue Alliance API</a></p>
            </div>
            <p style="margin: 130px 21vw 0 21vw">
                If you have tried searching for a state or province, you may have noticed that there are FRC
                teams in parts of the world that you haven't even heard of before. This is one of the great
                things about FIRST, unfortunately in this season it is not great for the teams themselves. 
                Examining the data, we can see that FRC teams in remote areas relative to events (e.g. teams in Asia
                 and Latin America).
                have much lower attendance rates than teams who are closer in proximity to FIRST events. The distance
                from events is what makes it difficult for these teams to attend often, making it much less likely
                that they attended an event this season, especially if they scheduled their first attendance later than week
                two. The issue of scheduling at the right time is a big one, accounting for most of the disparity in 
                participation across the board. Those who decided to plan their travels for early in the season got 
                to experience the game, however the unlucky few who scheduled later did not. Let's further examine the
                teams that have participated this season by taking a look at the teams that have attended more than
                one event. In a season consisting of only three weeks (accounting for week 0 events), attending more 
                than one event is a big leg up amongst the rest of the competition.
            </p>
            <p class="credit">Written by Aidan Walz, Team 5484 alumni - 2020</p>
        </div>
        <script>
            function displayChart(state_prov) {
                var searchBar = document.getElementById('search');
                searchBar.value = state_prov;

                // Load reigonal participation data
                fetch('./region_competed.json')
                    .then(res => res.json())
                    .then(data => render(data, state_prov))
                    .catch(err => console.error(err));

                function render(regionData, state_prov) {
                    if (document.getElementById('displayChart')) {
                        document.getElementById('displayChart').remove();
                    }

                    var canvas = document.createElement('canvas');
                    canvas.id = 'displayChart';
                    canvas.width = '200';
                    canvas.height = '200';
                    var displayContainer = document.getElementById('display-cont');
                    var displayDisclaimer = document.getElementById('displayDisclaimer');
                    displayContainer.insertBefore(canvas, displayDisclaimer);

                    attended = regionData[state_prov][1];
                    did_not_attend = regionData[state_prov][0] - attended;
                    if (did_not_attend < 0) {
                        did_not_attend = 0;
                    }

                    var chartTitle = document.getElementById('chartTitle');
                    chartTitle.textContent = state_prov + " FRC Teams that have Attended an Event in 2020 Season"
                    

                    var ctx = document.getElementById('displayChart').getContext('2d');
                    var myChart = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: ['Attended', 'Did not attend'],
                            datasets: [{
                                data: [attended, did_not_attend],
                                backgroundColor: [
                                    'rgba(255, 154, 81)',
                                    'rgba(81, 133, 255)',
                                ],
                                borderColor: [
                                    'rgba(255, 154, 81, 1)',
                                    'rgba(81, 133, 255, 1)',
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            
                        }
                    });
                    displayContainer.style.display = 'block';
                    hideDropdown();
                }
            }
            
            function getTerritoryNames() {
                var keyList = [];
                for (key in searchData) {
                    keyList.push(key)
                }
                keyList.sort();
                return keyList;
            }
            
            function fillDropdown(query) {
                var keys = getTerritoryNames();
                var filter = document.getElementById('filter');
                while(filter.firstChild) {
                    filter.removeChild(filter.lastChild);
                }
                var similar = findSimilar(keys, query);
                for (key in similar) {
                    var a = document.createElement('a');
                    var text = document.createTextNode(similar[key]);
                    a.appendChild(text);
                    a.href = "javascript:displayChart('" + text.textContent + "')";
                    a.className = "list-item";
                    filter.appendChild(a);
                }
                if (similar.length == 0) {
                    filter.style.border = "none";
                }
                else {
                    filter.style.border = "solid";
                    filter.style.borderWidth = "1px";
                    filter.style.borderColor = "grey";
                    filter.style.height = 'auto';
                }
            }
            
            function hideDropdown() {
                var filter = document.getElementById('filter');
                filter.style.display = "none";
            }
            
            function showDropdown() {
                var filter = document.getElementById('filter');
                filter.style.display = "flex";
            }
            
            function findSimilar(list, query) {
                output = [];
                if (query.length > 0) {
                    for (item in list) {
                        portion = list[item].toLowerCase().slice(0, query.length);
                        if (portion == query.toLowerCase()) {
                            output.push(list[item]);
                        }
                    }
                }
                return output;
            }
            
            var searchData = [];
            // Load basic team / territory data
            fetch('./teams_by_state.json')
                .then(res => res.json())
                .then(data => {searchData = data})
                .catch(err => console.error(err));

            var ctx = document.getElementById('eventSuspended').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Postponed', 'Completed'],
                    datasets: [{
                        data: [131, 62],
                        backgroundColor: [
                            'rgba(255, 99, 132)',
                            'rgba(54, 162, 235)',
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    
                }
            });

            var ctx = document.getElementById('teamsPlayed').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Attended', 'Did not attend'],
                    datasets: [{
                        data: [2065, 1847],
                        backgroundColor: [
                            'rgba(255, 175, 36)',
                            'rgba(119, 41, 255)',
                        ],
                        borderColor: [
                            'rgba(255, 175, 36, 1)',
                            'rgba(119, 41, 255, 1)',
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    
                }
            });
        </script>
    </body>
</html>